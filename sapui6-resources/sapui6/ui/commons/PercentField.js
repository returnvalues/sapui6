jQuery.sap.declare("sapui6.ui.commons.PercentField"),sap.ui.commons.TextField.extend("sapui6.ui.commons.PercentField",{library:"sapui6.ui.commons",metadata:{properties:{format:{type:"string",defaultValue:null},"float":{type:"boolean",defaultValue:!1}}},renderer:{},onAfterRendering:function(){$(this.getInputDomRef()).after('<span style="vertical-align:sub;">%</span>'),this.getFloat()?this.attachBrowserEvent("keydown",function(e){var t=window.event?event.keyCode:e.which,n=window.event?event.ctrlKey:e.ctrlKey,i=window.event?event.shiftKey:e.shiftKey;if(i)window.event?event.preventDefault?event.preventDefault():event.returnValue=!1:e.preventDefault();else{if(t>=48&&57>=t||t>=96&&105>=t||9==t||8==t||13==t||37==t||39==t||46==t||110==t||190==t||109==t||189==t)return!0;if(n&&86==t)return!0;if(n&&67==t)return!0;window.event?event.preventDefault?event.preventDefault():event.returnValue=!1:e.preventDefault()}}):this.attachBrowserEvent("keydown",function(e){var t=window.event?event.keyCode:e.which,n=window.event?event.ctrlKey:e.ctrlKey,i=window.event?event.shiftKey:e.shiftKey;if(i)window.event?event.preventDefault?event.preventDefault():event.returnValue=!1:e.preventDefault();else{if(t>=48&&57>=t||t>=96&&105>=t||9==t||8==t||13==t||37==t||39==t||46==t||109==t||189==t)return!0;if(n&&86==t)return!0;if(n&&67==t)return!0;window.event?event.preventDefault?event.preventDefault():event.returnValue=!1:e.preventDefault()}});var e=this;this.attachBrowserEvent("focus",function(){var t=e.getBindingInfo("value");t&&(e.getInputDomRef().value=t.binding.oValue)}),this.attachBrowserEvent("blur",function(){e.getBindingInfo("value")&&e.setValue(e.getDomRef().value)})}}),sapui6.ui.commons.PercentField.prototype.bindValue=function(e){this.bindProperty("value",{path:e,type:this.getType()})},sapui6.ui.commons.PercentField.prototype.getType=function(){var e=!1,t=",",n=".",i=0,r=0,a=0,o=0,u=this.getFormat();if(u.indexOf(",")>-1)if(e=!0,u.indexOf(".")>-1)if(u.indexOf(",")<u.indexOf(".")){t=",",n=".";var l=u.split(".")[0],s=u.split(".")[1];i=this._countChar(l,"0"),r=l.length,a=this._countChar(s,"0"),o=s.length}else{t=".",n=",";var l=u.split(",")[0],s=u.split(",")[1];i=this._countChar(l,"0"),r=l.length,a=this._countChar(s,"0"),o=s.length}else t=",",i=this._countChar(u,"0"),r=u.length;else if(u.indexOf(".")>-1){e=!1;var l=u.split(".")[0],s=u.split(".")[1];i=this._countChar(l,"0"),r=l.length,a=this._countChar(s,"0"),o=s.length}else e=!1,i=this._countChar(u,"0"),r=u.length;o>0&&this.setFloat(!0);var v=new sap.ui.model.type.Float({minIntegerDigits:i,minFractionDigits:a,maxFractionDigits:o,groupingEnabled:e,groupingSeparator:t,decimalSeparator:n});return v},sapui6.ui.commons.PercentField.prototype._countChar=function(e,t){for(var n=0,i=e.length,r=0;i>r;r++)e.charAt(r)==t&&n++;return n};